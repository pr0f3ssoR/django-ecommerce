{%load static%}
{%load json_conversion%}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {%if product_form.title.initial%}
    <title>{{product_form.title.initial}} - Update</title>
    {%else%}
    <title>Create New Product</title>
    {%endif%}
    <!-- <link rel="stylesheet" href="{%static 'products/css/product_form.css'%}"> -->
    <link rel="stylesheet" href="{%static 'products/css/new_product_form.css'%}">
</head>

<body>

    {%for error in errors%}
    {{error.attributes.errors}}
    {%endfor%}

    <div class="form-container">
        <div class="form-header">
            <h1>Product Management</h1>
            <p>Create and manage your product variants</p>
        </div>
        <div class="form-content">
            <form enctype="multipart/form-data" method="post" id="productForm">
                {%csrf_token%}
                <div class="product-details">
                    <div class="product-sub-section">
                        <div class="section-title">Product Details</div>
                        {%if product_form.id.value%}
                            <a href="{%url 'products:delete_product' pk=product_form.id.value%}">Delete</a>
                        {%endif%}
                    </div>
                    <div class="form-group">
                        {{product_form.title.label_tag}}
                        {{product_form.title}}
                    </div>
                    <div class="form-group">
                        {{product_form.description.label_tag}}
                        {{product_form.description}}
                    </div>
                    {{product_form.id}}
                </div>
                <div id="hiddenInputs">
                    {{variant_formset.management_form}}
                </div>
                <div id="deletedVariantInputs"></div>
                <div id="deleteInputs">
                    <div id="imageInputContainer">{{delete_form.delete_image_ids}}</div>
                    <div id="variantIdContainer">{{delete_form.delete_variant_ids}}</div>

                </div>
                <div class="variants-section">
                    <div class="variants-header">
                        <div class="section-title">Product Variants</div>
                        <button onclick="addVariant()" type="button" class="add-variant-btn">Add Variant</button>
                    </div>
                    <div id="variantsContainer">
                        {%for form in variant_formset%}
                        <div class="variant-card">
                            <div class="variant-header">
                                <div class="variant-title">Variant</div>
                                <button onclick="deleteVariant(this)" type="button" class="delete-variant-btn">
                                    Delete
                                </button>
                            </div>
                            <div class="variant-fields">
                                <div class="hidden-input">
                                    {{form.id}}
                                </div>
                                <div class="form-group">
                                    {{form.price.label_tag}}
                                    {{form.price}}
                                </div>
                                <div class="form-group">
                                    {{form.stock.label_tag}}
                                    {{form.stock}}
                                </div>
                            </div>
                            <div class="images-section">
                                <div class="images-header">
                                    <div class="subsection-title">Images</div>
                                </div>
                                <div class="hidden-input">
                                    {{form.image_input_field}}
                                </div>
                                <div class="image-upload-area" onclick="addImage(this)">
                                    <div class="upload-icon">ðŸ“·</div>
                                    <div class="upload-text">Click to upload</div>
                                    <div class="upload-hint">PNG, JPG, GIF up to 10MB</div>
                                </div>
                                
                                <div class="images-grid">
                                        {%for image in form.images.value|json_loads%}
                                        <div class="image-item">
                                            <img id="image-id-{{image.id}}" data-existingImage="true" class="image-preview" src="{{image.url}}" alt="">
                                            <div class="image-info">
                                                <div class="image-name" title="{{image.name}}">{{image.name}}</div>
                                                <div class="image-actions">
                                                    <button onclick="deleteImage(this)" type="button" class="delete-image-btn-card">
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        {%endfor%}
                                </div>                                
                            </div>
                            <div class="attributes-section">
                                <div class="attributes-header">
                                    <div class="attributes-title">Attributes</div>
                                    <button onclick="addAttributeElement(this)" type="button" class="add-attribute-btn">
                                        + Add Attribute
                                    </button>
                                </div>
                                {{form.attributes}}
                                {%for field in form.attributes.value|json_loads%}
                                <div class="attribute">
                                    <div class="attribute-item">
                                        <!-- <label for="">Name</label> -->
                                        <input type="text" value="{{field.name}}">
                                        <!-- <label for="">Value</label> -->
                                        <input type="text" value="{{field.value}}">
                                        <button onclick="removeAttributeElement(this)" type="button"
                                            class="delete-attribute-btn">
                                            Ã—
                                        </button>
                                    </div>
                                </div>
                                {%endfor%}
                            </div>
                        </div>
                        {%endfor%}
                        <div class="submit-section">
                            <button type="submit" class="submit-btn">Save Product</button>
                        </div>
                    </div>
            </form>
        </div>
    </div>
    <script src="{%static 'products/js/product_form.js'%}"></script>
</body>

</html>