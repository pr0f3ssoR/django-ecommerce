{%load static%}
{%load json_conversion%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>
    <link rel="stylesheet" href="{%static 'products/css/product_form.css'%}">
</head>
<body>

    {%for error in errors%}
    {{error.attributes.errors}}
    {%endfor%}

    <div class="form-container">
        <div class="form-header">
            <h1>Product Management</h1>
            <p>Create and manage your product variants</p>
        </div>
        <div class="form-content">
            <form method="post" id="productForm">
                {%csrf_token%}
                <div class="product-details">
                    <div class="section-title">Product Details</div>
                    <div class="form-group">
                        {{product_form.title.label_tag}}
                        {{product_form.title}}
                    </div>
                    <div class="form-group">
                        {{product_form.description.label_tag}}
                        {{product_form.description}}
                    </div>
                {{product_form.id}}
                </div>
                <div id="hiddenInputs">
                    {{variant_formset.management_form}}
                </div>
                <div id="deletedVariantInputs"></div>
                <div class="variants-section">
                    <div class="variants-header">
                        <div class="section-title">Product Variants</div>
                        <button onclick="addVariant()" type="button" class="add-variant-btn" >Add Variant</button>
                    </div>
                    <div id="variantsContainer">
                        {%for form in variant_formset%}
                            <div class="variant-card">
                                <div class="variant-header">
                                    <div class="variant-title">Variant</div>
                                    <button onclick="deleteVariant(this)" type="button" class="delete-variant-btn" >
                                        Delete
                                    </button>
                                </div>
                                <div class="variant-fields">
                                    <div class="hidden-input">
                                        {{form.id}}
                                    </div>
                                    <div class="form-group">
                                        {{form.price.label_tag}}
                                        {{form.price}}
                                    </div>
                                    <div class="form-group">
                                        {{form.stock.label_tag}}
                                        {{form.stock}}
                                    </div>
                                </div>
                                <div class="attributes-section">
                                    <div class="attributes-header">
                                        <div class="attributes-title">Attributes</div>
                                        <button onclick="addAttributeElement(this)" type="button" class="add-attribute-btn">
                                            + Add Attribute
                                        </button>
                                    </div>
                                    {{form.attributes}}
                                    {%for field in form.attributes.value|json_loads%}
                                        <div class="attribute">
                                            <div class="attribute-item">
                                                <!-- <label for="">Name</label> -->
                                                <input type="text" value="{{field.name}}">
                                                <!-- <label for="">Value</label> -->
                                                <input type="text" value="{{field.value}}">
                                                <button onclick="removeAttributeElement(this)" type="button" class="delete-attribute-btn">
                                                    Ã—
                                                </button>
                                            </div>
                                        </div>
                                    {%endfor%}
                                </div>
                            </div>
                        {%endfor%}
                    </div>
                </div>
                <div class="submit-section">
                    <button type="submit" class="submit-btn">Save Product</button>
                </div>
            </form>
        </div>
    </div>
<script src="{%static 'products/js/product_form.js'%}"></script>
</body>
</html>